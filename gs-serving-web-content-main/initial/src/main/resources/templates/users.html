<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Kh√°ch H√†ng - Coffee Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #8B4513, #D2691E);">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-coffee"></i> ‚òï Coffee Shop
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-home"></i> Trang Ch·ªß</a>
                <a class="nav-link active" href="/users"><i class="fas fa-users"></i> Kh√°ch H√†ng</a>
                <a class="nav-link" href="/login"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng Nh·∫≠p</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 style="color: #8B4513;"><i class="fas fa-users"></i> Danh S√°ch Kh√°ch H√†ng</h2>
                <p class="text-muted">Qu·∫£n l√Ω th√¥ng tin kh√°ch h√†ng mua h√†ng t·∫°i qu√°n</p>
            </div>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal" style="background: linear-gradient(135deg, #8B4513, #D2691E); border: none;">
                <i class="fas fa-plus"></i> Th√™m Kh√°ch H√†ng
            </button>
        </div>

        <!-- Search -->
        <div class="row mb-3">
            <div class="col-md-8">
                <form th:action="@{/users}" method="get" class="d-flex">
                    <input type="text" name="search" class="form-control" placeholder="üîç T√¨m ki·∫øm kh√°ch h√†ng..." th:value="${searchTerm}">
                    <button class="btn btn-outline-primary ms-2" type="submit">
                        <i class="fas fa-search"></i> T√¨m
                    </button>
                </form>
            </div>
            <div class="col-md-4 text-end">
                <span class="badge fs-6 p-2" style="background: linear-gradient(135deg, #8B4513, #D2691E);">
                    T·ªïng: <strong th:text="${#lists.size(users)}">0</strong> kh√°ch h√†ng
                </span>
            </div>
        </div>

        <!-- Table -->
        <div class="card">
            <div class="card-header" style="background: linear-gradient(135deg, #8B4513, #D2691E); color: white;">
                <h5 class="mb-0"><i class="fas fa-list"></i> Danh S√°ch Kh√°ch H√†ng</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>#</th>
                                <th><i class="fas fa-id-card"></i> M√£ KH</th>
                                <th><i class="fas fa-user"></i> T√™n Kh√°ch H√†ng</th>
                                <th><i class="fas fa-phone"></i> SƒêT</th>
                                <th><i class="fas fa-envelope"></i> Email</th>
                                <th><i class="fas fa-cogs"></i> Thao T√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Empty State -->
                            <tr th:if="${#lists.isEmpty(users)}">
                                <td colspan="6" class="text-center py-4">
                                    <i class="fas fa-users fa-3x mb-3 text-muted"></i>
                                    <h5>Ch∆∞a c√≥ kh√°ch h√†ng n√†o</h5>
                                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addModal">
                                        <i class="fas fa-plus"></i> Th√™m kh√°ch h√†ng ƒë·∫ßu ti√™n
                                    </button>
                                </td>
                            </tr>
                            
                            <!-- Customer Rows -->
                            <tr th:each="user, stat : ${users}">
                                <td th:text="${stat.count}">1</td>
                                <td><span class="badge bg-primary" th:text="${user.maKhachHang}">KH001</span></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 35px; height: 35px;">
                                            <span th:text="${#strings.substring(user.tenKhachHang, 0, 1).toUpperCase()}">A</span>
                                        </div>
                                        <strong th:text="${user.tenKhachHang}">Nguy·ªÖn VƒÉn A</strong>
                                    </div>
                                </td>
                                <td th:text="${user.soDienThoai ?: 'Ch∆∞a c√≥'}">0123456789</td>
                                <td th:text="${user.email ?: 'Ch∆∞a c√≥'}">email@example.com</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-info" th:onclick="'viewUser(\'' + ${user.maKhachHang} + '\')'">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" th:onclick="'editUser(\'' + ${user.maKhachHang} + '\')'">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" th:onclick="'deleteUser(\'' + ${user.maKhachHang} + '\')'">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Modal -->
    <div class="modal fade" id="addModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form th:action="@{/users/add}" method="post" th:object="${newUser}">
                    <div class="modal-header" style="background: linear-gradient(135deg, #8B4513, #D2691E); color: white;">
                        <h5 class="modal-title"><i class="fas fa-plus"></i> Th√™m Kh√°ch H√†ng</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">M√£ Kh√°ch H√†ng <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" th:field="*{maKhachHang}" placeholder="VD: KH001" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">T√™n Kh√°ch H√†ng <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" th:field="*{tenKhachHang}" placeholder="Nh·∫≠p h·ªç t√™n" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">S·ªë ƒêi·ªán Tho·∫°i</label>
                            <input type="tel" class="form-control" th:field="*{soDienThoai}" placeholder="VD: 0123456789">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" th:field="*{email}" placeholder="VD: email@example.com">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ƒê·ªãa Ch·ªâ</label>
                            <textarea class="form-control" th:field="*{diaChi}" rows="2" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #8B4513, #D2691E); border: none;">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function viewUser(id) {
            alert('Xem chi ti·∫øt kh√°ch h√†ng: ' + id);
        }
        
        function editUser(id) {
            alert('Ch·ªânh s·ª≠a kh√°ch h√†ng: ' + id);
        }
        
        function deleteUser(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√°ch h√†ng n√†y?')) {
                window.location.href = '/users/delete/' + id;
            }
        }
    </script>
</body>
</html>

    <div class="container mt-4">
        <!-- Alert Messages -->
        <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle"></i> <span th:text="${message}">Success message</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle"></i> <span th:text="${error}">Error message</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="h3" style="color: #8B4513;">
                    <i class="fas fa-coffee"></i> ‚òï Qu·∫£n L√Ω S·∫£n Ph·∫©m C√† Ph√™
                </h1>
                <p class="text-muted">Th√™m, s·ª≠a, x√≥a v√† qu·∫£n l√Ω menu c√† ph√™ trong h·ªá th·ªëng</p>
            </div>
            <div class="col-auto">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal" style="background: linear-gradient(135deg, #8B4513, #D2691E); border: none;">
                    <i class="fas fa-plus"></i> Th√™m S·∫£n Ph·∫©m M·ªõi
                </button>
                <button type="button" class="btn btn-success" onclick="exportToCSV()">
                    <i class="fas fa-download"></i> Xu·∫•t Excel
                </button>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="row mb-4">
            <div class="col-md-8">
                <form th:action="@{/products}" method="get" class="d-flex">
                    <input type="text" 
                           name="search" 
                           class="form-control" 
                           placeholder="üîç T√¨m ki·∫øm theo m√£ s·∫£n ph·∫©m, t√™n, lo·∫°i c√† ph√™..."
                           th:value="${searchTerm}">
                    <select name="category" class="form-select ms-2" style="max-width: 200px;">
                        <option value="">T·∫•t c·∫£ danh m·ª•c</option>
                        <option value="espresso" th:selected="${category == 'espresso'}">Espresso</option>
                        <option value="americano" th:selected="${category == 'americano'}">Americano</option>
                        <option value="latte" th:selected="${category == 'latte'}">Latte</option>
                        <option value="cappuccino" th:selected="${category == 'cappuccino'}">Cappuccino</option>
                        <option value="mocha" th:selected="${category == 'mocha'}">Mocha</option>
                        <option value="frappuccino" th:selected="${category == 'frappuccino'}">Frappuccino</option>
                    </select>
                    <button class="btn btn-outline-primary ms-2" type="submit">
                        <i class="fas fa-search"></i> T√¨m Ki·∫øm
                    </button>
                    <a href="/products" class="btn btn-outline-secondary ms-2">
                        <i class="fas fa-refresh"></i> T·∫•t C·∫£
                    </a>
                </form>
            </div>
            <div class="col-md-4 text-end">
                <div class="d-inline-block">
                    <span class="badge fs-6 p-2" style="background: linear-gradient(135deg, #8B4513, #D2691E);">
                        <i class="fas fa-coffee"></i> 
                        T·ªïng s·ªë: <strong th:text="${#lists.size(products)}">0</strong> s·∫£n ph·∫©m
                    </span>
                </div>
            </div>
        </div>

        <!-- Products Table Card -->
        <div class="card shadow-sm">
            <div class="card-header text-white" style="background: linear-gradient(135deg, #8B4513, #D2691E);">
                <h5 class="card-title mb-0">
                    <i class="fas fa-coffee"></i> Menu C√† Ph√™
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col" class="text-center">#</th>
                                <th scope="col"><i class="fas fa-barcode"></i> M√£ S·∫£n Ph·∫©m</th>
                                <th scope="col"><i class="fas fa-coffee"></i> T√™n S·∫£n Ph·∫©m</th>
                                <th scope="col"><i class="fas fa-tag"></i> Danh M·ª•c</th>
                                <th scope="col"><i class="fas fa-dollar-sign"></i> Gi√° (VNƒê)</th>
                                <th scope="col"><i class="fas fa-boxes"></i> T·ªìn Kho</th>
                                <th scope="col"><i class="fas fa-info-circle"></i> M√¥ T·∫£</th>
                                <th scope="col" class="text-center"><i class="fas fa-cogs"></i> Thao T√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Empty State -->
                            <tr th:if="${#lists.isEmpty(products)}">
                                <td colspan="8" class="text-center py-5 text-muted">
                                    <i class="fas fa-coffee fa-3x mb-3 d-block" style="color: #8B4513;"></i>
                                    <h5>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong menu</h5>
                                    <p>H√£y th√™m s·∫£n ph·∫©m c√† ph√™ ƒë·∫ßu ti√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu kinh doanh!</p>
                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal" style="background: linear-gradient(135deg, #8B4513, #D2691E); border: none;">
                                        <i class="fas fa-plus"></i> Th√™m S·∫£n Ph·∫©m ƒê·∫ßu Ti√™n
                                    </button>
                                </td>
                            </tr>
                            
                            <!-- Product Rows -->
                            <tr th:each="product, iterStat : ${products}" class="product-row">
                                <td class="text-center">
                                    <span class="badge bg-secondary" th:text="${iterStat.count}">1</span>
                                </td>
                                <td>
                                    <span class="badge fs-6" style="background: linear-gradient(135deg, #8B4513, #D2691E);" th:text="${product.maProductPham}">SP001</span>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="coffee-icon me-2" style="width: 40px; height: 40px; background: linear-gradient(135deg, #8B4513, #D2691E); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-coffee text-white"></i>
                                        </div>
                                        <div>
                                            <strong th:text="${product.tenSanPham}">C√† Ph√™ Espresso</strong>
                                            <br>
                                            <small class="text-muted" th:text="${product.size ?: 'Size M'}">Size M</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-info" th:text="${product.danhMuc ?: 'Espresso'}">Espresso</span>
                                </td>
                                <td>
                                    <strong class="text-success" th:text="${#numbers.formatDecimal(product.gia ?: 45000, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'">45,000 VNƒê</strong>
                                </td>
                                <td>
                                    <span th:class="${(product.soLuongTon ?: 0) > 10 ? 'badge bg-success' : (product.soLuongTon ?: 0) > 5 ? 'badge bg-warning' : 'badge bg-danger'}" 
                                          th:text="${product.soLuongTon ?: 0}">50</span>
                                    <small class="text-muted d-block">ly</small>
                                </td>
                                <td>
                                    <span th:title="${product.moTa}" 
                                          th:text="${product.moTa != null and #strings.length(product.moTa) > 30 ? 
                                                   #strings.substring(product.moTa, 0, 30) + '...' : 
                                                   (product.moTa ?: 'Ch∆∞a c√≥ m√¥ t·∫£')}">
                                        C√† ph√™ nguy√™n ch·∫•t...
                                    </span>
                                </td>
                                <td class="text-center">
                                    <div class="btn-group" role="group" aria-label="Product actions">
                                        <button type="button" 
                                                class="btn btn-sm btn-outline-info" 
                                                th:onclick="'viewProductDetails(\'' + ${product.maSanPham} + '\')'">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" 
                                                class="btn btn-sm btn-outline-warning"
                                                th:onclick="'editProduct(\'' + ${product.maSanPham} + '\')'">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" 
                                                class="btn btn-sm btn-outline-danger"
                                                th:onclick="'confirmDeleteProduct(\'' + ${product.maSanPham} + '\', \'' + ${product.tenSanPham} + '\')'">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-light" th:if="${!#lists.isEmpty(products)}">
                <small class="text-muted">
                    <i class="fas fa-coffee"></i> 
                    Hi·ªÉn th·ªã <strong th:text="${#lists.size(products)}">0</strong> s·∫£n ph·∫©m
                    <span th:if="${searchTerm}" class="ms-2">
                        | K·∫øt qu·∫£ t√¨m ki·∫øm cho: "<strong th:text="${searchTerm}"></strong>"
                    </span>
                </small>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form th:action="@{/products/add}" method="post" th:object="${newProduct}" novalidate>
                    <div class="modal-header text-white" style="background: linear-gradient(135deg, #8B4513, #D2691E);">
                        <h5 class="modal-title" id="addProductModalLabel">
                            <i class="fas fa-plus"></i> Th√™m S·∫£n Ph·∫©m C√† Ph√™ M·ªõi
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="maSanPham" class="form-label">
                                    <i class="fas fa-barcode" style="color: #8B4513;"></i> M√£ S·∫£n Ph·∫©m <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="maSanPham"
                                       th:field="*{maSanPham}" 
                                       placeholder="VD: SP001" 
                                       required>
                                <div class="invalid-feedback">
                                    Vui l√≤ng nh·∫≠p m√£ s·∫£n ph·∫©m.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="tenSanPham" class="form-label">
                                    <i class="fas fa-coffee" style="color: #8B4513;"></i> T√™n S·∫£n Ph·∫©m <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       id="tenSanPham"
                                       th:field="*{tenSanPham}" 
                                       placeholder="VD: C√† Ph√™ Espresso" 
                                       required>
                                <div class="invalid-feedback">
                                    Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m.
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="danhMuc" class="form-label">
                                    <i class="fas fa-tag" style="color: #8B4513;"></i> Danh M·ª•c <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="danhMuc" th:field="*{danhMuc}" required>
                                    <option value="">Ch·ªçn danh m·ª•c</option>
                                    <option value="espresso">Espresso</option>
                                    <option value="americano">Americano</option>
                                    <option value="latte">Latte</option>
                                    <option value="cappuccino">Cappuccino</option>
                                    <option value="mocha">Mocha</option>
                                    <option value="frappuccino">Frappuccino</option>
                                    <option value="cold-brew">Cold Brew</option>
                                    <option value="specialty">Specialty Coffee</option>
                                </select>
                                <div class="invalid-feedback">
                                    Vui l√≤ng ch·ªçn danh m·ª•c.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="size" class="form-label">
                                    <i class="fas fa-expand-arrows-alt" style="color: #8B4513;"></i> K√≠ch Th∆∞·ªõc
                                </label>
                                <select class="form-select" id="size" th:field="*{size}">
                                    <option value="S">Small (S)</option>
                                    <option value="M" selected>Medium (M)</option>
                                    <option value="L">Large (L)</option>
                                    <option value="XL">Extra Large (XL)</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="gia" class="form-label">
                                    <i class="fas fa-dollar-sign" style="color: #8B4513;"></i> Gi√° B√°n (VNƒê) <span class="text-danger">*</span>
                                </label>
                                <input type="number" 
                                       class="form-control" 
                                       id="gia"
                                       th:field="*{gia}" 
                                       placeholder="VD: 45000"
                                       min="0"
                                       step="1000"
                                       required>
                                <div class="invalid-feedback">
                                    Vui l√≤ng nh·∫≠p gi√° b√°n h·ª£p l·ªá.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="soLuongTon" class="form-label">
                                    <i class="fas fa-boxes" style="color: #8B4513;"></i> S·ªë L∆∞·ª£ng T·ªìn Kho
                                </label>
                                <input type="number" 
                                       class="form-control" 
                                       id="soLuongTon"
                                       th:field="*{soLuongTon}" 
                                       placeholder="VD: 50"
                                       min="0"
                                       value="0">
                                <small class="form-text text-muted">S·ªë ly c√≥ th·ªÉ pha</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="moTa" class="form-label">
                                <i class="fas fa-info-circle" style="color: #8B4513;"></i> M√¥ T·∫£ S·∫£n Ph·∫©m
                            </label>
                            <textarea class="form-control" 
                                      id="moTa"
                                      th:field="*{moTa}" 
                                      rows="3" 
                                      placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ h∆∞∆°ng v·ªã, ngu·ªìn g·ªëc, c√°ch pha ch·∫ø..."></textarea>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> 
                            <small>C√°c tr∆∞·ªùng c√≥ d·∫•u <span class="text-danger">*</span> l√† b·∫Øt bu·ªôc</small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times"></i> H·ªßy B·ªè
                        </button>
                        <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #8B4513, #D2691E); border: none;">
                            <i class="fas fa-save"></i> L∆∞u S·∫£n Ph·∫©m
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Product Details Modal -->
    <div class="modal fade" id="viewProductModal" tabindex="-1" aria-labelledby="viewProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="viewProductModalLabel">
                        <i class="fas fa-eye"></i> Chi Ti·∫øt S·∫£n Ph·∫©m C√† Ph√™
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="productDetailsContent">
                    <!-- Content will be loaded dynamically by JavaScript -->
                    <div class="text-center py-3">
                        <div class="spinner-border" style="color: #8B4513;" role="status">
                            <span class="visually-hidden">ƒêang t·∫£i...</span>
                        </div>
                        <p class="mt-2">ƒêang t·∫£i th√¥ng tin s·∫£n ph·∫©m...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> ƒê√≥ng
                    </button>
                    <button type="button" class="btn btn-warning" onclick="editCurrentProduct()">
                        <i class="fas fa-edit"></i> Ch·ªânh S·ª≠a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form id="editProductForm" method="post" action="/products/update" novalidate>
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title" id="editProductModalLabel">
                            <i class="fas fa-edit"></i> Ch·ªânh S·ª≠a Th√¥ng Tin S·∫£n Ph·∫©m
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="editProductContent">
                        <!-- Content will be loaded dynamically by JavaScript -->
                        <div class="text-center py-3">
                            <div class="spinner-border text-warning" role="status">
                                <span class="visually-hidden">ƒêang t·∫£i...</span>
                            </div>
                            <p class="mt-2">ƒêang t·∫£i form ch·ªânh s·ª≠a...</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times"></i> H·ªßy B·ªè
                        </button>
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-save"></i> C·∫≠p Nh·∫≠t S·∫£n Ph·∫©m
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteProductModal" tabindex="-1" aria-labelledby="deleteProductModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteProductModalLabel">
                        <i class="fas fa-exclamation-triangle"></i> X√°c Nh·∫≠n X√≥a S·∫£n Ph·∫©m
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-coffee fa-4x text-danger mb-3"></i>
                        <h5>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh·ªèi menu?</h5>
                        <p class="lead">
                            <strong id="deleteProductName">T√™n s·∫£n ph·∫©m</strong>
                        </p>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>C·∫£nh b√°o:</strong> S·∫£n ph·∫©m s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn kh·ªèi h·ªá th·ªëng!
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> H·ªßy B·ªè
                    </button>
                    <form id="deleteProductForm" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash"></i> X√≥a S·∫£n Ph·∫©m
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="/js/app.js"></script>
    
    <!-- Inline JavaScript for Coffee Product Management -->
    <script>
        // Global variables
        let currentProductId = null;

        // View product details function
        function viewProductDetails(productId) {
            currentProductId = productId;
            const modal = new bootstrap.Modal(document.getElementById('viewProductModal'));
            
            fetch(`/products/details/${productId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(product => {
                    const content = document.getElementById('productDetailsContent');
                    content.innerHTML = `
                        <div class="row">
                            <div class="col-md-4 text-center mb-3">
                                <div class="coffee-icon mx-auto" style="width: 100px; height: 100px; background: linear-gradient(135deg, #8B4513, #D2691E); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
                                    <i class="fas fa-coffee text-white"></i>
                                </div>
                                <h5 class="mt-3">${product.tenSanPham}</h5>
                                <span class="badge" style="background: linear-gradient(135deg, #8B4513, #D2691E);">${product.maSanPham}</span>
                                <br>
                                <span class="badge bg-info mt-2">${product.danhMuc || 'Kh√¥ng x√°c ƒë·ªãnh'}</span>
                            </div>
                            <div class="col-md-8">
                                <table class="table table-borderless">
                                    <tbody>
                                        <tr>
                                            <td><i class="fas fa-barcode" style="color: #8B4513;"></i> <strong>M√£ SP:</strong></td>
                                            <td>${product.maSanPham}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-coffee" style="color: #8B4513;"></i> <strong>T√™n:</strong></td>
                                            <td>${product.tenSanPham}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-tag" style="color: #8B4513;"></i> <strong>Danh m·ª•c:</strong></td>
                                            <td>${product.danhMuc || 'Ch∆∞a ph√¢n lo·∫°i'}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-expand-arrows-alt" style="color: #8B4513;"></i> <strong>Size:</strong></td>
                                            <td>${product.size || 'M'}</td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-dollar-sign" style="color: #8B4513;"></i> <strong>Gi√° b√°n:</strong></td>
                                            <td><strong class="text-success">${new Intl.NumberFormat('vi-VN').format(product.gia || 0)} VNƒê</strong></td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-boxes" style="color: #8B4513;"></i> <strong>T·ªìn kho:</strong></td>
                                            <td>
                                                <span class="badge ${(product.soLuongTon || 0) > 10 ? 'bg-success' : (product.soLuongTon || 0) > 5 ? 'bg-warning' : 'bg-danger'}">
                                                    ${product.soLuongTon || 0} ly
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-info-circle" style="color: #8B4513;"></i> <strong>M√¥ t·∫£:</strong></td>
                                            <td>${product.moTa || 'Ch∆∞a c√≥ m√¥ t·∫£'}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    modal.show();
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('C√≥ l·ªói x·∫£y ra khi t·∫£i th√¥ng tin s·∫£n ph·∫©m!', 'danger');
                });
        }

        // Edit product function
        function editProduct(productId) {
            currentProductId = productId;
            const modal = new bootstrap.Modal(document.getElementById('editProductModal'));
            
            fetch(`/products/details/${productId}`)
                .then(response => response.json())
                .then(product => {
                    const content = document.getElementById('editProductContent');
                    content.innerHTML = `
                        <input type="hidden" name="maSanPham" value="${product.maSanPham}">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">M√£ S·∫£n Ph·∫©m</label>
                                <input type="text" class="form-control" value="${product.maSanPham}" readonly>
                                <small class="form-text text-muted">M√£ s·∫£n ph·∫©m kh√¥ng th·ªÉ thay ƒë·ªïi</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√™n S·∫£n Ph·∫©m <span class="text-danger">*</span></label>
                                <input type="text" name="tenSanPham" class="form-control" value="${product.tenSanPham}" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Danh M·ª•c</label>
                                <select name="danhMuc" class="form-select">
                                    <option value="espresso" ${product.danhMuc === 'espresso' ? 'selected' : ''}>Espresso</option>
                                    <option value="americano" ${product.danhMuc === 'americano' ? 'selected' : ''}>Americano</option>
                                    <option value="latte" ${product.danhMuc === 'latte' ? 'selected' : ''}>Latte</option>
                                    <option value="cappuccino" ${product.danhMuc === 'cappuccino' ? 'selected' : ''}>Cappuccino</option>
                                    <option value="mocha" ${product.danhMuc === 'mocha' ? 'selected' : ''}>Mocha</option>
                                    <option value="frappuccino" ${product.danhMuc === 'frappuccino' ? 'selected' : ''}>Frappuccino</option>
                                    <option value="cold-brew" ${product.danhMuc === 'cold-brew' ? 'selected' : ''}>Cold Brew</option>
                                    <option value="specialty" ${product.danhMuc === 'specialty' ? 'selected' : ''}>Specialty Coffee</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">K√≠ch Th∆∞·ªõc</label>
                                <select name="size" class="form-select">
                                    <option value="S" ${product.size === 'S' ? 'selected' : ''}>Small (S)</option>
                                    <option value="M" ${product.size === 'M' ? 'selected' : ''}>Medium (M)</option>
                                    <option value="L" ${product.size === 'L' ? 'selected' : ''}>Large (L)</option>
                                    <option value="XL" ${product.size === 'XL' ? 'selected' : ''}>Extra Large (XL)</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Gi√° B√°n (VNƒê) <span class="text-danger">*</span></label>
                                <input type="number" name="gia" class="form-control" value="${product.gia || ''}" min="0" step="1000" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">S·ªë L∆∞·ª£ng T·ªìn Kho</label>
                                <input type="number" name="soLuongTon" class="form-control" value="${product.soLuongTon || 0}" min="0">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">M√¥ T·∫£ S·∫£n Ph·∫©m</label>
                            <textarea name="moTa" class="form-control" rows="3">${product.moTa || ''}</textarea>
                        </div>
                    `;
                    modal.show();
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('C√≥ l·ªói x·∫£y ra khi t·∫£i form ch·ªânh s·ª≠a!', 'danger');
                });
        }

        // Edit current product from view modal
        function editCurrentProduct() {
            if (currentProductId) {
                bootstrap.Modal.getInstance(document.getElementById('viewProductModal')).hide();
                setTimeout(() => editProduct(currentProductId), 300);
            }
        }

        // Confirm delete product function
        function confirmDeleteProduct(productId, productName) {
            document.getElementById('deleteProductName').textContent = productName;
            document.getElementById('deleteProductForm').action = `/products/delete/${productId}`;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteProductModal'));
            modal.show();
        }

        // Export to CSV function
        function exportToCSV() {
            const products = Array.from(document.querySelectorAll('.product-row')).map(row => {
                const cells = row.querySelectorAll('td');
                return {
                    stt: cells[0].textContent.trim(),
                    maSanPham: cells[1].textContent.trim(),
                    tenSanPham: cells[2].querySelector('strong').textContent.trim(),
                    danhMuc: cells[3].textContent.trim(),
                    gia: cells[4].textContent.replace(/\s+/g, ' ').trim(),
                    tonKho: cells[5].textContent.replace(/\s+/g, ' ').trim(),
                    moTa: cells[6].textContent.replace(/\s+/g, ' ').trim()
                };
            });

            if (products.length === 0) {
                showNotification('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!', 'warning');
                return;
            }

            const csvContent = [
                ['STT', 'M√£ SP', 'T√™n S·∫£n Ph·∫©m', 'Danh M·ª•c', 'Gi√°', 'T·ªìn Kho', 'M√¥ T·∫£'],
                ...products.map(product => [
                    product.stt,
                    product.maSanPham,
                    product.tenSanPham,
                    product.danhMuc,
                    product.gia,
                    product.tonKho,
                    product.moTa
                ])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `menu_ca_phe_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Xu·∫•t file menu c√† ph√™ th√†nh c√¥ng!', 'success');
        }

        // Show notification function
        function showNotification(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.minWidth = '300px';
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add form validation
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                });
            });

            // Auto-hide alerts after 5 seconds
            setTimeout(() => {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    const bsAlert = new bootstrap.Alert(alert);
                    if (bsAlert) bsAlert.close();
                });
            }, 5000);

            // Format price inputs
            const priceInputs = document.querySelectorAll('input[name="gia"]');
            priceInputs.forEach(input => {
                input.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            });

            console.log('Coffee Shop Management System initialized successfully! ‚òï');
        });
    </script>
</body>
</html>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function confirmDelete(button) {
            const userId = button.getAttribute('data-user-id');
            const userName = button.getAttribute('data-user-name');
            
            document.getElementById('deleteUserName').textContent = userName;
            document.getElementById('deleteForm').action = '/users/delete/' + userId;
            
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            deleteModal.show();
        }
    </script>
</body>
</html>
