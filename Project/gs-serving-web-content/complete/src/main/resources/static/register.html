<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Coffee Shop - Đăng ký</title>
    <style>
        :root{
            --coffee-900:#3e2723;
            --coffee-700:#5d4037;
            --coffee-500:#6d4c41;
            --accent:#c59d5f;
            --accent-rgb:197,157,95;
            --danger:#d84343;
            --success:#2e7d32;
        }
        *{box-sizing:border-box;font-family:system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif}
        body{
            margin:0;min-height:100vh;
            display:grid;place-items:center;
            padding:34px 18px;
            background:
              radial-gradient(900px 520px at 100% -10%,rgba(var(--accent-rgb),.12),transparent 60%),
              radial-gradient(760px 420px at -10% 100%,rgba(109,76,65,.10),transparent 65%),
              linear-gradient(180deg,#f3ece9,#ffffff 45%);
            color:var(--coffee-900);
        }
        .card{
            width:100%;
            max-width:560px;
            background:#fff;
            border:1px solid rgba(62,39,35,.09);
            border-radius:26px;
            padding:40px 40px 36px;
            display:flex;
            flex-direction:column;
            gap:26px;
            box-shadow:
              0 18px 42px -16px rgba(62,39,35,.35),
              0 8px 26px -14px rgba(0,0,0,.18);
            position:relative;
        }
        .brand{
            display:flex;
            align-items:center;
            gap:14px;
        }
        .logo{
            width:54px;height:54px;
            display:grid;place-items:center;
            background:linear-gradient(135deg,rgba(255,255,255,.3),rgba(255,255,255,.05));
            border:1px solid rgba(62,39,35,.12);
            border-radius:18px;
            font-size:30px;
            backdrop-filter:blur(6px);
            color:var(--coffee-700);
        }
        h1{
            margin:0;
            font-size:26px;
            font-weight:600;
            line-height:1.1;
            letter-spacing:.4px;
            background:linear-gradient(90deg,var(--coffee-900),var(--coffee-700));
            -webkit-background-clip:text;
            color:transparent;
        }
        .subtitle{
            margin:4px 0 0;
            font-size:13.5px;
            color:#6d5a53;
            letter-spacing:.35px;
        }
        form{display:grid;gap:24px}
        .grid{
            display:grid;
            gap:18px 20px;
            grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
        }
        .field{display:grid;gap:7px}
        .field label{
            font-size:12px;
            font-weight:600;
            letter-spacing:.55px;
            text-transform:uppercase;
            color:#6b524a;
        }
        .control{position:relative}
        .control input{
            width:100%;
            padding:14px 16px 12px;
            border:1px solid rgba(62,39,35,.26);
            border-radius:16px;
            font-size:14.5px;
            background:#fff;
            transition:.25s;
            font-weight:500;
        }
        .control input:focus{
            outline:0;
            border-color:var(--accent);
            box-shadow:0 0 0 3px rgba(var(--accent-rgb),.35);
        }
        .password-meter{
            display:flex;
            gap:4px;
            margin-top:4px;
        }
        .password-meter span{
            flex:1;
            height:5px;
            background:#e2d8d3;
            border-radius:4px;
            transition:.3s;
        }
        .password-meter[data-score="1"] span:nth-child(-n+1){background:#d65f5f}
        .password-meter[data-score="2"] span:nth-child(-n+2){background:#e09856}
        .password-meter[data-score="3"] span:nth-child(-n+3){background:#d2b556}
        .password-meter[data-score="4"] span:nth-child(-n+4){background:#7cbf61}
        .password-meter[data-score="5"] span:nth-child(-n+5){background:#37a148}
        .note{
            font-size:11.5px;
            color:#7a675f;
            margin-top:-4px;
        }
        .alert{
            font-size:13px;
            padding:11px 14px;
            border-radius:14px;
            border:1px solid;
            line-height:1.45;
            display:flex;
            gap:8px;
            align-items:flex-start;
        }
        .alert.error{background:#fff4f4;border-color:#f6c9c9;color:var(--danger)}
        .alert.success{background:#f0faf1;border-color:#bfe3c4;color:var(--success)}
        .actions{display:flex;flex-direction:column;gap:12px}
        .btn{
            border:0;
            cursor:pointer;
            padding:14px 20px;
            font-size:15px;
            font-weight:600;
            border-radius:20px;
            background:linear-gradient(135deg,var(--accent),#e4bd7d);
            color:#392514;
            letter-spacing:.45px;
            display:inline-flex;
            align-items:center;
            justify-content:center;
            gap:8px;
            box-shadow:0 12px 28px -12px rgba(var(--accent-rgb),.6),0 4px 10px rgba(0,0,0,.08);
            transition:.3s;
        }
        .btn:hover{filter:brightness(1.05);transform:translateY(-2px)}
        .btn:active{transform:translateY(0)}
        .alt{
            text-align:center;
            font-size:13px;
            color:#6d5a53;
        }
        .alt a{
            color:var(--coffee-700);
            font-weight:600;
            text-decoration:none;
        }
        .alt a:hover{text-decoration:underline}
        @media (max-width:520px){
            body{padding:26px 14px}
            .card{padding:34px 28px 30px;border-radius:22px}
            h1{font-size:24px}
            .grid{grid-template-columns:1fr}
        }
    </style>
    <script>
        function scorePassword(p){
            let score=0;
            if(!p) return 0;
            const letters={};
            for(let i=0;i<p.length;i++){
                letters[p[i]]=(letters[p[i]]||0)+1;
                score+=2/letters[p[i]];
            }
            const variations={
                digits:/\d/.test(p),
                lower:/[a-z]/.test(p),
                upper:/[A-Z]/.test(p),
                nonWords:/[\W_]/.test(p)
            };
            let variationCount=0;
            for(const k in variations) variationCount+=variations[k]?1:0;
            score += (variationCount - 1) * 8;
            return parseInt(score);
        }
        function updateMeter(){
            const pwd=document.getElementById('password');
            const meter=document.querySelector('.password-meter');
            if(!pwd || !meter) return;
            const s=scorePassword(pwd.value.trim());
            meter.dataset.score = s === 0 ? 0 : Math.min(5, Math.ceil(s/20));
        }
        document.addEventListener('DOMContentLoaded',()=>{
            const pwd=document.getElementById('password');
            if(pwd){
                pwd.addEventListener('input',updateMeter);
                updateMeter();
            }
        });
    </script>
</head>
<body>
<div class="card">
    <div class="brand">
        <div class="logo">☕</div>
        <div>
            <h1>Đăng ký</h1>
            <p class="subtitle">Tạo tài khoản mới</p>
        </div>
    </div>

    <form id="registerForm" action="#" method="post">
        <div class="grid">
            <div class="field">
                <label for="fullName">Họ tên</label>
                <div class="control">
                    <input id="fullName" name="fullName" required autocomplete="name"/>
                </div>
            </div>
            <div class="field">
                <label for="username">Username</label>
                <div class="control">
                    <input id="username" name="username" required autocomplete="username"/>
                </div>
            </div>
            <div class="field">
                <label for="email">Email</label>
                <div class="control">
                    <input id="email" name="email" type="email" required autocomplete="email"/>
                </div>
            </div>
            <div class="field">
                <label for="phone">Điện thoại</label>
                <div class="control">
                    <input id="phone" name="phone" autocomplete="tel"/>
                </div>
            </div>
            <div class="field">
                <label for="password">Mật khẩu</label>
                <div class="control">
                    <input id="password" name="password" type="password" required minlength="4" autocomplete="new-password"/>
                </div>
                <div class="password-meter" data-score="0" aria-hidden="true">
                    <span></span><span></span><span></span><span></span><span></span>
                </div>
                <div class="note">Nên có chữ hoa, số & ký tự đặc biệt.</div>
            </div>
            <div class="field">
                <label for="confirm">Xác nhận mật khẩu</label>
                <div class="control">
                    <input id="confirm" name="confirmPassword" type="password" required autocomplete="new-password"/>
                </div>
            </div>
        </div>

        <div id="alertError" class="alert error" style="display:none"><strong>✖</strong> Lỗi: Vui lòng kiểm tra lại.</div>
        <div id="alertSuccess" class="alert success" style="display:none"><strong>✔</strong> Đã tạo tài khoản. Chuyển hướng...</div>

        <div class="actions">
            <button class="btn" type="submit">Tạo tài khoản</button>
            <div class="alt">Đã có tài khoản? <a href="login.html">Đăng nhập</a></div>
        </div>
    </form>
    <script>
        (function(){
            const form = document.getElementById('registerForm');
            const alertError = document.getElementById('alertError');
            const alertSuccess = document.getElementById('alertSuccess');
            function genId(){ return 'u_' + Date.now(); }
            form.addEventListener('submit', function(ev){
                ev.preventDefault();
                alertError.style.display = 'none';
                const data = {};
                ['fullName','username','email','phone','password','confirmPassword','address','birthDate'].forEach(k=>data[k]= (form[k] && form[k].value) ? form[k].value.trim() : '');
                if(!data.username || !data.email || !data.password){ alertError.style.display='flex'; return; }
                if(data.password !== data.confirmPassword){ alertError.style.display='flex'; return; }
                try{
                    const raw = localStorage.getItem('users');
                    const users = raw ? JSON.parse(raw) : [];
                    if(users.find(u => u.username === data.username || u.email === data.email)){
                        alertError.style.display='flex'; return;
                    }
                    const user = { id: genId(), username: data.username, email: data.email, password: data.password, name: data.fullName || data.username };
                    users.push(user);
                    localStorage.setItem('users', JSON.stringify(users));
                    alertSuccess.style.display='flex';
                    setTimeout(()=>{ sessionStorage.setItem('currentUser', JSON.stringify({id:user.id,username:user.username,email:user.email})); window.location.href='dashboard.html'; }, 800);
                }catch(e){ console.error(e); alertError.style.display='flex'; }
            });
        })();
    </script>
</div>
</body>
</html>